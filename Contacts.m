/* Contacts.m  Version:0.1 Created by WANG Hailei on 7/10/10. */#import "Contacts.h"@implementation Contacts@synthesize artsmeshContacts;/*  Get the contacts under group Artsmesh, and assign it to property artsmeshGroupContacts. */- (void) retrieveArtsmeshContactsFromXMPPService {		// TODO: Need to select a service form a list, or a TextFiled to input the name.	IMService * xmppService = [IMService serviceWithName:@"Bonjour"];		NSMutableArray * availableContacts = [[NSMutableArray alloc] initWithCapacity:5];	if ( [xmppService status] == IMServiceStatusLoggedIn ) {		for ( NSDictionary * infoItem in [xmppService infoForAllScreenNames] ) {			// If the Contact's status is "Available", then add this contact to the avialabeContacts array.			// The return type of [infoItem objectForKey:@"IMPersonStatus"] is NSCFNumber, which needs cast to compare with IMPersonStatusAvailable.			// There is some problem in casting, therefore, I cast both sides into String to compare the value.			// TODO: Change @"4" to IMPersonStatusAvailable.			if ( [[[infoItem objectForKey:@"IMPersonStatus"] stringValue] isEqualToString:@"4"] ||			     [[[infoItem objectForKey:@"IMPersonStatus"] stringValue] isEqualToString:@"3"] ||			     [[[infoItem objectForKey:@"IMPersonStatus"] stringValue] isEqualToString:@"2"] ) {								//[infoItem retain];				[availableContacts addObject:infoItem];			}		}		// artsmeshContacs is a NSArray, therefore, I created a NSMutalbeArray availabeContacts for temparory usage.		//[availableContacts retain];		self.artsmeshContacts = availableContacts;	}	}	- (void) startMonitoring {		NSNotificationCenter * imNotificationCenter = [IMService notificationCenter];	[imNotificationCenter addObserver:self				 selector:@selector(imContactStatusChangedNotification:)				     name:IMPersonStatusChangedNotification				   object:nil];}- (void) stopMonitoring {		NSNotificationCenter * imNotificationCenter = [IMService notificationCenter];	[imNotificationCenter removeObserver:self];}		- (void) awakeFromNib {		[self startMonitoring];}		#pragma mark -#pragma mark Notifications	/*  Received from IMService's custom notification center.  Posted when a different user (screenName) logs in, logs off, goes away, and so on.  This notification is for the IMService object. The user information dictionary will always contain an  IMPersonScreenNameKey and an IMPersonStatusKey, and no others.  */- (void) imContactStatusChangedNotification:(NSNotification *)notification {	//	IMService * service = [notification object];	[self retrieveArtsmeshContactsFromXMPPService];}	@end